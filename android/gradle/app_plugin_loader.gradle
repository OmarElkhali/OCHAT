// app_plugin_loader.gradle

def flutterProjectRoot = rootProject.projectDir.parentFile.toPath()

def plugins = new Properties()
def pluginsFile = new File(flutterProjectRoot.toFile(), '.flutter-plugins')
if (pluginsFile.exists()) {
    pluginsFile.withReader('UTF-8') { reader -> plugins.load(reader) }
}

plugins.each { name, path ->
    def pluginDirectory = flutterProjectRoot.resolve(path).toFile()
    def includeFlutterPlugins = false
    if (pluginDirectory.exists()) {
        includeFlutterPlugins = new File(pluginDirectory, 'flutter_pubspec.yaml').exists()
    }
    if (includeFlutterPlugins) {
        apply from: "$flutterProjectRoot/packages/flutter_tools/gradle/flutter.gradle"
    }
}
